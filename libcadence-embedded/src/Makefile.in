SHELL=/bin/sh

CC=@CC@
CPP=@CXX@
AR=ar
CPPFLAGS=@CXXFLAGS@
LDFLAGS=@LDFLAGS@
INCLUDES=-I@top_srcdir@/libcadence-embedded/include -I@top_builddir@/libcadence-embedded/include

SOURCES=memory.cpp agenthandler.cpp directory.cpp cadence.cpp messages.cpp module.cpp notation.cpp softagent.cpp
OBJECTS=$(SOURCES:.cpp=.o)
LIB=libcadence-embedded.so
DOSTEOBJ=./core/libcadencecore.a ./notations/libcadencenotations.a ./handlers/libcadencehandlers.a ./library/libcadencelib.a

all: $(SOURCES) $(LIB)

$(LIB): $(OBJECTS)
	cd core; make
	cd handlers; make
	cd notations; make
	cd library; make
	$(CPP) --shared $(LDFLAGS) -o ../$@ $(OBJECTS) $(DOSTEOBJ)

.cpp.o:
	$(CPP) -fPIC -c $(CPPFLAGS) $(INCLUDES) $< -o $@

clean:
	rm -f *.o
	cd core; make clean
	cd notations; make clean
	cd handlers; make clean
	cd library; make clean
